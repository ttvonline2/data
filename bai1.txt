Mục tiêu

Tính Điểm gốc: tổng quãng đường ngắn nhất mà mỗi quân phải đi từ vị trí ban đầu tới Ô Đích khi chưa bỏ tường.

Tính Giá trị ròng: với từng ô có tường, thử “đập” đúng ô đó, tính lại tổng quãng đường, lấy phần giảm xuống; cộng tất cả phần giảm của mọi tường.

Tính Điểm gốc

Chạy tìm-đường rộng (Bê E F S) một lần duy nhất từ Ô Đích tới mọi ô trống.

Khoảng cách từ Đích tới ô của quân số i (gọi là “đê i”) có ngay trong bảng khoảng cách.

Cộng tất cả “đê i” ta được Điểm gốc, ký hiệu “đê lớn”.

Chuẩn bị để đánh giá mỗi ô tường

Liệt kê mọi ô tường, đánh số từ 0 đến w trừ một.

Với mỗi ô tường, xét bốn ô kề (trên, dưới, trái, phải) – chỉ cần ô nào trống.

Phần đường từ ô tường tới Đích sau khi phá tường bằng: “một bước để ra khỏi tường” cộng “khoảng cách nhỏ nhất từ một ô kề tới Đích”. Lưu giá trị này thành destPart[wall].

Khoảng cách từ mỗi quân tới mọi ô

Số quân nhỏ (không quá năm mươi) – ta chạy Bê E F S riêng cho từng quân để có bảng khoảng cách distPawn[i]. Chi phí tối đa hai triệu ô, thoải mái.

Giá trị của một ô tường

Với một tường đã chọn:

Với từng quân, tìm ô kề của tường gần quân nhất: lấy distPawn[i][neighbor] + một; chọn nhỏ nhất gọi enter.

Đường qua tường dài enter + destPart[wall].

Đường tốt nhất của quân khi tường bị phá là min(đê i cũ, enter + destPart[wall]).

Cộng lại cho tất cả quân được NewScore của bàn sau khi phá tường.

Giá trị của tường = đê lớn − NewScore (không âm).

Giá trị ròng

Lặp qua tất cả tường, cộng Giá trị của chúng.

Độ phức tạp

Một lần Bê E F S từ Đích + N lần từ quân: ô × (N+1) ≤ 2 × 10⁶.

Vòng lặp tường × quân × tối đa 4 láng giềng: ≈ 8 × 10⁶ phép so sánh.

Phù hợp với giới hạn.

